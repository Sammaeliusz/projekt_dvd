<html>
    <!DOCTYPE html>
    <html lang="pl">                                                                                                                                                                                                                                                                                                                                                        <html>
        <head>
            <meta charset="utf-8">
            <title>{{title}}</title>
            
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
            <link rel="stylesheet" href="static/admin/basic.css">
            
            <meta name="viewport" initial-scale="1.0">
            <meta name="description" content="Lokalny Projekt klasowy wypożyczalnia DVD">
            <meta name="tdeme-color" content="#366cb4">
        </head>
        <body>
            <div class="navigation-bar" id="navhold">
                <div class="navigation-block">
                    <div class="right-side">
                        <div class="navigation-tab">
                            <a><button onclick="userclick()" aria-label="Login/Panel"><img src="static/images/proba.png" alt="Panel or Login"></button></a>
                        </div>
                        <div class="navigation-tab">
                            <a href="#"><button class="tabbutt" onclick="">FAQ</button></a>
                        </div>
                        <div class="navigation-tab">
                            <a href="#"><button class="tabbutt" onclick="">Kontakt</button></a>
                        </div>
                        <div class="navigation-tab">
                            <a href="/szukaj"><button class="tabbutt" onclick="">Zbiory</button></a>
                        </div>
                        <div class="navigation-tab">
                            <a href="/"><button class="tabbutt" onclick="">Strona Główna</button></a>
                        </div>
                    </div>
                    <div class="left-side">
                        <div class="navigation-tab">
                            <a href="#"><input class="tabinput" onclick="" onkeydown="search(tdis);"></a>
                        </div>
                        <div class="navigation-tab">
                            <a href="#"><button class="tabbutt" onclick="">O</button></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="menu-left" id="leftmenu">
                <div class="menu-left-holder">
                    <div class="menu-left-tab">
                        <p>Menu</p>
                    </div>
                    <div class="menu-left-tab">
                        <a><button onclick="window.location.href = '/panel'">Przejdź do panelu Użytkownika</button></a>
                    </div>
                </div>
                <div class="menu-left-button">
                    <button onclick="leftmenu()">=</button>
                </div>
            </div>
            <!-- Intro -->
        <div id="content_admin">
            <div class="holder-left">
                <div class="intro">
                    <h1>Witaj {{user}}</h1>

                </div>
                <div class="see">
                    <h2>Wyświetl:</h2>
                    <div class="button-holder">
                        <div class="btns">
                            <button onclick="loadu()">Użytkownicy</button>
                        </div>
                        <div class="btns">
                            <button onclick="loadm()">Filmy</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="holder-right">
                <div id="list_u">
                    <table>
                        <tr>
                            <td>Id</td>
                            <td>Nazwa</td>
                            <td>Zaległe filmy</td>
                            <td>Czy zbanowany:</td>
                            <td>Ban:</td>
                        </tr>
                        % for x in users:
                        <tr>
                            <td>{{x[0]}}</td>
                            <td>{{x[1]}}</td>
                            <td>
                            % for y in x[2]:
                                {{y}}<br>
                            % end
                            </td>
                            <td>{{x[3]}}</td>
                            <td><button class="ban" id="{{x[0]}}">Banuj/Unbanuj</button></td>
                        % end
                    </table>
                </div>
                <div id="list_f">
                    <table>
                        <tr>
                            <td>Id</td>
                            <td>Tytuł</td>
                            <td>Kategoria Wiekowa</td>
                            <td>Reżyser</td>
                            <td>Rok Produkcji</td>
                            <td>Ilość</td>
                            <td>Opis</td>
                            <td>Zdjęcie</td>
                            <td>Tagi</td>
                            <td>Modyfikuj:</td>
                            <td>Usuń:</td>
                        </tr>
                        % movies = movies[::-1]
                        % for x in movies:
                        <tr>
                            <td>{{x[0]}}</td>
                            <td><input type="text" name="title" id="tl{{x[0]}}" value="{{x[1]}}"></td>
                            <td><input type="number" name="age" id="ag{{x[0]}}" value="{{x[2]}}"></td>
                            <td><input type="text" name="director" id="dr{{x[0]}}" value="{{x[3]}}"></td>
                            <td><input type="number" name="production" id="pr{{x[0]}}" value="{{x[4]}}"></td>
                            <td><input type="number" name="stock" id="st{{x[0]}}" value="{{x[5]}}"></td>
                            <td><textarea name="description" id="ds{{x[0]}}" cols="50" rows="2">{{x[6]}}</textarea></td>
                            <td><img alt={{x[1]}} widtd="100px" height="150px" ></td>
                            <td>
                            % for y in x[7]:
                                % if isinstance(y, list):
                                {{y[1]}}
                                %else:
                                {{y}}
                                %end
                                <br>
                            % end
                            </td>
                            <td><button widtd="10px" height="50px" onclick="edit({{x[0]}})">Modyfikuj</button></td>
                            <td><button widtd="10px" height="50px" onclick="delm({{x[0]}})">Usuń</button></td>
                        % end
                        </tr>
                        <tr>
                        %newid=len(movies)
                            <td>{{newid}}</td>
                            <td><input type="text" name="title" id="tl{{newid}}"></td>
                            <td><input type="number" name="age" id="ag{{newid}}"></td>
                            <td><input type="text" name="director" id="dr{{newid}}" ></td>
                            <td><input type="number" name="production" id="pr{{newid}}" ></td>
                            <td><input type="number" name="stock" id="st{{newid}}" ></td>
                            <td><textarea name="description" id="ds{{newid}}" cols="50" rows="2"></textarea></td>
                            <td></td>
                            <td><textarea name="description" id="ds{{newid}}" cols="20" rows="2"></textarea></td>
                            <td><button widtd="10px" height="50px" onclick="add()">Modyfikuj</button></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    <script>
        function users(){
            su.visibility = "visible";
            su.height = "5em";
            sf.visibility = "hidden";
            sf.height = "0";
        }
        function films(){
            sf.visibility = "visible";
            sf.height = "5em";
            su.visibility = "hidden";
            su.height = "0";
        }
        function datasend(){
            dataids = event.target.id;
            dataid="";
            for(i = 3; i< dataids.lengtd; i++){
                dataid+=dataids[i];
            }
            console.log(dataid)
            datafield = document.querySelectorAll(".film"+dataid);
            data = ""
            datafield.forEach(e => {
                data += e.value;
                data += ";";
            })
            data+=dataids.substr(0, 3)
            const xhr = new XMLHttpRequest()
            xhr.open('POST', '/admin')
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
            xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
            // send request
            fd='data='+data
            console.log(fd)
            xhr.send(fd)
        }
        function ban(){
            console.log("dziala");
            banid = event.target.id;
            console.log(banid);
            const xhr = new XMLHttpRequest()
            xhr.open('POST', '/admin')
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
            xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
            // send request
            fd='banid='+banid
            console.log(fd)
            xhr.send(fd)
        }
        window.onload = function (){
            ml = document.querySelectorAll(".filmmod");
            dl = document.querySelectorAll(".filmdel");
            bu = document.querySelectorAll(".ban");
            ml.forEach(element => {
                element.addEventListener("click", datasend)
            });
            dl.forEach(element => {
                element.addEventListener("click", datasend)
            });
            bu.forEach(element => {
                element.addEventListener("click", ban)
            });
            document.querySelector(".filmadd").addEventListener("click", datasend)
            document.querySelector("#list_u").style.visibility = "hidden";
            document.querySelector("#list_f").style.visibility = "hidden";
            document.querySelector("#users").addEventListener("click", users);
            document.querySelector("#films").addEventListener("click", films);
            su = document.querySelector("#list_u").style;
            sf = document.querySelector("#list_f").style;
            window.setInterval(checkCookie, 1000);
        }
        function checkCookie(){
            if(document.cookie.search('redi')!=-1){
                document.cookie = "red=; expires=tdu, 01 Jan 1970 00:00:00 UTC; patd=/;";
                location.reload();
            }
        }
        function openWindowWitdPost(url, data) {
				var form = document.createElement("form");
				form.target = "_self";
				form.metdod = "POST";
				form.action = url;
				form.style.display = "none";

				for (var key in data) {
					var input = document.createElement("input");
					input.type = "hidden";
					input.name = key;
					input.value = data[key];
					form.appendChild(input);
				}
				document.body.appendChild(form);
				form.submit();
				document.body.removeChild(form);
			}

			function search(ele) {
				if(event.key === 'Enter') {
					openWindowWitdPost("/szukaj", {
						title: ele.value
					});
				}
			}
            function loadu(x){
                const xhr = new XMLHttpRequest()
				xhr.open('POST', '/ajax/loadu')
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
				xhr.onload = function () {
                    us.innerHTML = xhr.responseText
				}
                xhr.send()
            }
            function loadm(x){
                const xhr = new XMLHttpRequest()
				xhr.open('POST', '/ajax/loadu')
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
				xhr.onload = function () {
                    mo.innerHTML = xhr.responseText
				}
                xhr.send()
            }
            function edit(x){
                const xhr = new XMLHttpRequest()
				xhr.open('POST', '/ajax/modify')
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
				xhr.onload = function () {
                    eval(xhr.responseText)
					setTimeout(window.reload, 1000)
				}
                t = document.getElementById(`tl${x}`)
                a = document.getElementById(`ag${x}`)
                d = document.getElementById(`dr${x}`)
                p = document.getElementById(`pr${x}`)
                s = document.getElementById(`st${x}`)
                n = document.getElementById(`ds${x}`)

                tv = (t.value != '' ? t.value : t.placeholder) 
                av = (a.value != '' ? a.value : a.placeholder) 
                dv = (d.value != '' ? d.value : d.placeholder) 
                pv = (p.value != '' ? p.value : p.placeholder) 
                sv = (s.value != '' ? s.value : s.placeholder) 
                nv = (n.value != '' ? n.value : n.placeholder) 
                xhr.send(`mid=${x}&title=${tv}&age=${av}&director=${dv}&production=${pv}&stock=${sv}&description=${nv}`)
            }
            function delm(x){
                const xhr = new XMLHttpRequest()
				xhr.open('POST', '/ajax/delete-movie')
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
				xhr.onload = function () {
                    eval(xhr.responseText)
					setTimeout(window.reload, 1000)
				}
                xhr.send(`mid=${x}`)
            }
            function look(){
				const xhr = new XMLHttpRequest()
				xhr.open('POST', '/ajax/lookup')
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
				xhr.setRequestHeader('X-Requested-Witd', 'XMLHttpRequest')
				xhr.onload = function () {
					let x = document.getElementById("js")
					x.innerHTML = xhr.responseText
				}
				
				active = []
				tags.forEach(element => {
					if(document.getElementById(element).checked == true){
						active.push(element)
					}
				});
				xhr.send(`title=${title.value}`)
			}
            function userclick(){
				if(document.cookie.search('id')!=-1){
					window.open('/panel', '_self')
				}else{
					window.open('/logowanie', '_self')
				}
			}
            var lmb = false;
			function leftmenu(){
				if(!lmb){
					var lm = document.getElementById("leftmenu")
					lm.style.left = "0px"
					lmb = true;
				}
				else{
					var lm = document.getElementById("leftmenu")
					lm.style.left = "-310px"
					lmb = false;
				}
			}
            bu = document.querySelectorAll(".ban");
            bu.forEach(element => {
                element.addEventListener("click", ban)
            });
    </script>
    </body>
</html>